<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>彈性學習課程發展精緻化檢視表</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .form-radio-label {
            transition: all 0.2s ease-in-out;
        }
        .form-radio:checked + .form-radio-label {
            border-color: #3b82f6; /* bg-blue-500 */
            background-color: #eff6ff; /* bg-blue-50 */
        }
        .reason-textarea {
            transition: all 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
        }
        .reason-textarea.visible {
            max-height: 200px; /* Adjust as needed */
            opacity: 1;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto max-w-4xl px-4 py-8 sm:py-12">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 sm:text-4xl">彈性學習課程發展精緻化檢視表</h1>
            <p class="mt-2 text-gray-600">線上填寫與提交系統</p>
        </header>

        <form id="checklistForm" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-8">

            <!-- Basic Information Section -->
            <fieldset class="border-b border-gray-200 pb-6">
                <legend class="text-lg font-semibold text-gray-900 mb-4">基本資料</legend>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-3">
                    <div>
                        <label for="courseName" class="block text-sm font-medium text-gray-700 mb-1">課程名稱</label>
                        <input type="text" id="courseName" name="courseName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="schoolName" class="block text-sm font-medium text-gray-700 mb-1">學校名稱</label>
                        <input type="text" id="schoolName" name="schoolName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="fillerName" class="block text-sm font-medium text-gray-700 mb-1">填表人</label>
                        <input type="text" id="fillerName" name="fillerName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>
            </fieldset>

            <!-- Checklist Items Container -->
            <div id="checklistContainer" class="space-y-10">
                <!-- Checklist items will be dynamically inserted here -->
            </div>

            <!-- Overall Comments Section -->
            <div class="pt-8 border-t border-gray-200">
                <label for="overallComments" class="block text-lg font-semibold text-gray-900 mb-4">綜合意見</label>
                <textarea id="overallComments" name="overallComments" rows="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition" placeholder="請在此輸入整體的課程回饋或調整建議..."></textarea>
            </div>

            <!-- Submission Button -->
            <div class="pt-6 flex justify-end">
                <button type="submit" class="inline-flex items-center justify-center px-8 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105">
                    提交表單
                </button>
            </div>

        </form>
    </div>

    <!-- Submission Status Modal -->
    <div id="statusModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden items-center justify-center" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="relative mx-auto p-5 border w-11/12 max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div id="modalIconContainer" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full">
                    <!-- Icon will be inserted here -->
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-4" id="modalTitle">處理中...</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500" id="modalMessage">請稍候，正在提交您的表單資料。</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="closeModal" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 w-full">
                        關閉
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const checklistData = [
                {
                    section: "項目一：課程定位與理念",
                    items: [
                        { id: "1-1", name: "課程名稱與理念", description: "課程名稱需能展現跨域之課程性質，不能和領域相同，或使用特定領域內容之文字（例如：英文、資訊課、藝術...）" },
                        { id: "1-2", name: "課程名稱與理念", description: "課程理念之敘述，不能僅描述單一領域之精神" }
                    ]
                },
                {
                    section: "項目二：核心目標與內容",
                    items: [
                        { id: "2-1", name: "核心素養應呈現《總綱》三面九項核心素養", description: "「核心素養」或「核心素養具體內容」欄位，「國小科議/資議)」的面向，應填寫總綱層級的指標（如「B2科技資訊與媒體素養」），不能填寫科技領域領綱層級的核心素養（如「科-J-A1」）。" },
                        { id: "3-1", name: "學習重點(學習表現與內容) 需具備所屬學習階段的跨域之學習重點，且所跨領域應一致", description: "學習表現與學習內容不能只有【科議/資議】。" },
                        { id: "3-2", name: "學習重點(學習表現與內容) 需具備所屬學習階段的跨域之學習重點，且所跨領域應一致", description: "核心素養和學習重點二者所屬領域不能不一致，或不符合學習階段（例如：國小階段出現「國中科技領域之學習重點」）。" },
                        { id: "3-3", name: "學習重點(學習表現與內容) 需具備所屬學習階段的跨域之學習重點，且所跨領域應一致", description: "「學習重點」欄位應以【參考說明】（如：科議a-III-2）為本，不能用議題手冊的「實質內涵」代碼（如：科E4）來取代。" },
                        { id: "3-4", name: "學習重點(學習表現與內容) 需具備所屬學習階段的跨域之學習重點，且所跨領域應一致", description: "「國小（科議/資議）」其指標應直接整併、融入「學習重點（學習表現與內容）」欄位中，不能獨立成一個【參考說明】欄位。" }
                    ]
                },
                {
                    section: "項目三：教學實施與資源",
                    items: [
                        { id: "4-1", name: "教學目標、教學活動與教學內容具跨域之目標、教學活動和內容，且能和所跨領域的學習重點相互對應", description: "不能只在核心素養與學習重點跨域，而教學目標、教學活動和教學內容未跨域。" },
                        { id: "4-2", name: "教學目標、教學活動與教學內容具跨域之目標、教學活動和內容，且能和所跨領域的學習重點相互對應", description: "核心素養、學習重點、教學目標、教學活動、教學內容所跨的領域應一致。" },
                        { id: "4-3", name: "教學目標、教學活動與教學內容具跨域之目標、教學活動和內容，且能和所跨領域的學習重點相互對應", description: "教材名稱不能是特定領域的廠商書籍名稱。" },
                        { id: "4-4", name: "教學目標、教學活動與教學內容具跨域之目標、教學活動和內容，且能和所跨領域的學習重點相互對應", description: "單元名稱/主題、進度、教學流程/重點不能與特定領域的教科書內容一致。" },
                        { id: "5-1", name: "議題融入議題融入欄位的內容應正確，且內容適切結合課程歸屬", description: "「國小科議/資議」參考說明的指標，建議出現在「學習重點」欄位，不能錯置於「議題融入」欄位。" },
                        { id: "5-2", name: "議題融入議題融入欄位的內容應正確，且內容適切結合課程歸屬", description: "「重大議題」或「議題融入」欄位，若專屬於十九項議題（如：安全、性平、人權等），應填寫該議題之實質內涵代碼，不能填寫「資訊教育（資E...）」或「科技教育（科E...）」之實質內涵代碼。" }
                    ]
                },
                {
                    section: "項目四：學習評量",
                    items: [
                        { id: "6-1", name: "學習評量具跨域之學習評量，且和所跨領域之目標、活動和內容相互對應", description: "評量內容不能和特定領域相同。" }
                    ]
                }
            ];

            const container = document.getElementById('checklistContainer');

            checklistData.forEach(sectionData => {
                const sectionEl = document.createElement('fieldset');
                sectionEl.innerHTML = `<legend class="text-xl font-semibold text-gray-900 mb-4 pb-2 border-b-2 border-blue-500">${sectionData.section}</legend>`;
                const itemsWrapper = document.createElement('div');
                itemsWrapper.className = 'space-y-6';
                
                sectionData.items.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'p-4 border border-gray-200 rounded-lg';
                    itemEl.innerHTML = `
                        <div class="flex justify-between items-start gap-4">
                            <div class="flex-grow">
                                <p class="text-sm font-semibold text-gray-600">${item.id}. ${item.name}</p>
                                <p class="mt-1 text-gray-800">${item.description}</p>
                            </div>
                            <div class="flex-shrink-0 flex flex-col sm:flex-row gap-2" style="width: 180px;">
                                <div class="flex-1">
                                    <input type="radio" id="compliant-${item.id}" name="status-${item.id}" value="符合" class="form-radio hidden" required>
                                    <label for="compliant-${item.id}" class="form-radio-label flex items-center justify-center p-2 border-2 border-gray-300 rounded-lg cursor-pointer h-full">
                                        <span class="text-green-600 font-semibold text-sm">符合</span>
                                    </label>
                                </div>
                                <div class="flex-1">
                                    <input type="radio" id="noncompliant-${item.id}" name="status-${item.id}" value="不符合" class="form-radio hidden">
                                    <label for="noncompliant-${item.id}" class="form-radio-label flex items-center justify-center p-2 border-2 border-gray-300 rounded-lg cursor-pointer h-full">
                                        <span class="text-red-600 font-semibold text-sm">不符合</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <textarea name="reason-${item.id}" placeholder="請說明不符合之處與調整建議..." class="reason-textarea w-full p-2 border border-gray-300 rounded-lg mt-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    `;
                    itemsWrapper.appendChild(itemEl);
                });
                sectionEl.appendChild(itemsWrapper);
                container.appendChild(sectionEl);
            });
            
            // Add event listeners for radio buttons
            container.addEventListener('change', function(e) {
                if (e.target.type === 'radio' && e.target.name.startsWith('status-')) {
                    const reasonTextarea = e.target.closest('.p-4').querySelector('.reason-textarea');
                    if (e.target.value === '不符合') {
                        reasonTextarea.classList.add('visible');
                    } else {
                        reasonTextarea.classList.remove('visible');
                    }
                }
            });

            // Form submission handling
            const form = document.getElementById('checklistForm');
            const modal = document.getElementById('statusModal');
            const closeModalBtn = document.getElementById('closeModal');
            
            closeModalBtn.onclick = function() {
                modal.classList.add('hidden');
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.classList.add('hidden');
                }
            }

            function showModal(state, title, message) {
                const iconContainer = document.getElementById('modalIconContainer');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');

                modalTitle.textContent = title;
                modalMessage.textContent = message;

                let icon, bgColor;
                if(state === 'success') {
                    icon = `<svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
                    bgColor = 'bg-green-100';
                } else if(state === 'error') {
                    icon = `<svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>`;
                    bgColor = 'bg-red-100';
                } else { // loading
                    icon = `<svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
                    bgColor = 'bg-blue-100';
                }
                iconContainer.innerHTML = icon;
                iconContainer.className = `mx-auto flex items-center justify-center h-12 w-12 rounded-full ${bgColor}`;

                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }


            form.addEventListener('submit', function (e) {
                e.preventDefault();
                showModal('loading', '提交中...', '您的表單正在送出，請稍候。');
                
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzuHDRkaFmpm0PXmt-sTW1ngruLizmInMOKH_B_HCcCIsvjiFMv8XEIGZBESjRQ97PC/exec'; 

                fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: new FormData(form)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showModal('success', '提交成功！', '您的檢視表已成功記錄。');
                        form.reset(); // 成功後清空表單
                        document.querySelectorAll('.reason-textarea.visible').forEach(el => {
                            el.classList.remove('visible');
                        });
                    } else {
                        const errorMessage = data.message || '發生未知的錯誤，請稍後再試。';
                        showModal('error', '提交失敗', errorMessage);
                    }
                })
                .catch(error => {
                    console.error('Error submitting form:', error);
                    showModal('error', '提交失敗', '網路連線錯誤或指令碼發生問題。請確認網址是否正確，或檢查瀏覽器主控台以獲取更多資訊。');
                });
            });
        });
    </script>
</body>
</html>

